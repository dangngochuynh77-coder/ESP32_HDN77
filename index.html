<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ESP32 Web Flasher</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  margin-top: 80px;
  background: #0f172a;
  color: white;
}
button {
  font-size: 16px;
  margin: 10px;
  padding: 10px 20px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}
#connect { background-color: #3b82f6; color: white; }
#flash { background-color: #10b981; color: white; }
#reset { background-color: #f59e0b; color: white; }
#status { margin-top: 20px; font-size: 18px; }
input[type=file] { margin-top: 20px; }
</style>
<script type="module">
import { ESPLoader } from "https://unpkg.com/esptool-js@0.5.4/dist/web/index.js";

let loader, port;

async function connect() {
  try {
    port = await navigator.serial.requestPort();
    await port.open({ baudRate: 115200 });
    loader = new ESPLoader(port);
    await loader.initialize();
    document.getElementById("status").innerText = "âœ… ÄÃ£ káº¿t ná»‘i ESP32";
  } catch (e) {
    document.getElementById("status").innerText = "âŒ Lá»—i: " + e.message;
  }
}

async function flash() {
  try {
    const file = document.getElementById("binFile").files[0];
    if (!file) return alert("Chá»n file .bin trÆ°á»›c");

    const buffer = await file.arrayBuffer();
    const flashOffset = 0x1000;

    document.getElementById("status").innerText = "â³ Äang ghi...";
    await loader.flashData(buffer, flashOffset);
    document.getElementById("status").innerText = "âœ… Náº¡p thÃ nh cÃ´ng!";
  } catch (e) {
    document.getElementById("status").innerText = "âŒ Lá»—i: " + e.message;
  }
}

async function reset() {
  if (loader) {
    await loader.hardReset();
    document.getElementById("status").innerText = "ğŸ” ESP32 Ä‘Ã£ reset";
  }
}

window.connect = connect;
window.flash = flash;
window.reset = reset;
</script>
</head>
<body>
  <h1>âš¡ ESP32 Web Flasher</h1>
  <input type="file" id="binFile" accept=".bin"><br>
  <button id="connect" onclick="connect()">ğŸ”Œ Káº¿t ná»‘i</button>
  <button id="flash" onclick="flash()">â¬†ï¸ Náº¡p</button>
  <button id="reset" onclick="reset()">ğŸ” Reset</button>
  <p id="status">ChÆ°a káº¿t ná»‘i</p>
  <footer style="margin-top:40px;font-size:13px;opacity:0.6">
    Â© 2025 ESP32 Web Flasher - Powered by esptool-js
  </footer>
</body>
</html>
